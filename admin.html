<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Matheus Barber Shop</title>
    <link rel="icon" type="image/jpg" href="https://i.ibb.co/dwMYqmPk/IMG-2261.jpg">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: linear-gradient(135deg, #1a1a1a 0%, #000 100%); color: #fff; min-height: 100vh; }
        .container { max-width: 1000px; margin: 0 auto; padding: 20px; }
        .header { background: rgba(0,0,0,0.5); padding: 20px; text-align: center; border-bottom: 2px solid #d4af37; margin-bottom: 30px; }
        .header-logo { max-width: 200px; height: auto; margin-bottom: 10px; }
        .header p { color: #888; font-size: 14px; }
        .admin-login { max-width: 400px; margin: 100px auto; background: #2a2a2a; padding: 40px; border-radius: 15px; border: 2px solid #d4af37; }
        .welcome { text-align: center; margin-bottom: 30px; }
        .welcome .logo-admin { max-width: 180px; height: auto; margin-bottom: 20px; }
        .welcome h2 { font-size: 32px; margin-bottom: 10px; }
        .welcome p { color: #888; }
        .form-group { margin-bottom: 20px; }
        .form-label { display: block; margin-bottom: 8px; font-weight: bold; }
        .form-input { width: 100%; padding: 15px; background: #1a1a1a; border: 2px solid #333; border-radius: 10px; color: #fff; font-size: 16px; }
        .form-input:focus { outline: none; border-color: #d4af37; }
        .btn { width: 100%; padding: 18px; border: none; border-radius: 10px; font-size: 18px; font-weight: bold; cursor: pointer; margin-bottom: 15px; }
        .btn-primary { background: linear-gradient(135deg, #d4af37 0%, #b8860b 100%); color: #000; }
        .back-btn { padding: 12px 20px; background: #2a2a2a; color: #fff; border: none; border-radius: 8px; cursor: pointer; width: 100%; }
        .admin-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; flex-wrap: wrap; gap: 10px; }
        .logout-btn { background: #dc3545; color: #fff; padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 30px; }
        .stat-card { background: #2a2a2a; padding: 20px; border-radius: 10px; text-align: center; border: 2px solid #333; }
        .stat-number { font-size: 32px; font-weight: bold; color: #d4af37; margin-bottom: 5px; }
        .stat-label { color: #888; font-size: 14px; }
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; overflow-x: auto; }
        .tab-btn { flex: 1; min-width: 100px; padding: 15px 8px; background: #2a2a2a; border: 2px solid #333; border-radius: 8px; cursor: pointer; font-weight: bold; color: #fff; font-size: 13px; }
        .tab-btn.active { background: #d4af37; color: #000; border-color: #d4af37; }
        .booking-card, .service-card, .client-card, .settings-card { background: #2a2a2a; padding: 20px; border-radius: 10px; margin-bottom: 15px; border: 2px solid #333; }
        .booking-header, .client-header { display: flex; justify-content: space-between; margin-bottom: 15px; }
        .booking-client, .client-name { font-size: 18px; font-weight: bold; margin-bottom: 5px; }
        .booking-phone, .client-phone { color: #25d366; font-size: 14px; }
        .client-email { color: #888; font-size: 14px; margin-top: 3px; }
        .booking-actions { display: flex; gap: 10px; margin-top: 15px; flex-wrap: wrap; }
        .action-btn { flex: 1; min-width: 90px; padding: 10px 5px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 13px; }
        .btn-confirm { background: #007bff; color: #fff; }
        .btn-complete { background: #28a745; color: #fff; }
        .btn-cancel { background: #dc3545; color: #fff; }
        .btn-edit { background: #ffc107; color: #000; }
        .btn-delete { background: #6c757d; color: #fff; }
        .service-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px; }
        .service-info { display: flex; align-items: center; gap: 15px; }
        .service-icon { font-size: 40px; }
        .service-name { font-size: 20px; font-weight: bold; }
        .service-duration { font-size: 14px; color: #888; }
        .service-price { font-size: 28px; font-weight: bold; color: #d4af37; }
        .service-image { width: 100%; height: 200px; object-fit: cover; border-radius: 10px; margin-bottom: 15px; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 1000; overflow-y: auto; }
        .modal.active { display: flex; align-items: center; justify-content: center; padding: 20px; }
        .modal-content { background: #1a1a1a; padding: 30px; border-radius: 15px; max-width: 500px; width: 100%; border: 2px solid #d4af37; margin: 20px; }
        .modal-title { font-size: 24px; margin-bottom: 20px; color: #d4af37; }
        .modal-close { float: right; font-size: 28px; cursor: pointer; color: #888; line-height: 20px; }
        .modal-close:hover { color: #fff; }
        .image-preview { width: 100%; max-height: 200px; object-fit: cover; border-radius: 10px; margin: 10px 0; display: none; }
        .image-preview.active { display: block; }
        .file-input-wrapper { position: relative; overflow: hidden; display: inline-block; width: 100%; }
        .file-input-btn { background: #2a2a2a; color: #d4af37; padding: 15px; border: 2px dashed #d4af37; border-radius: 10px; cursor: pointer; text-align: center; width: 100%; display: block; }
        .file-input-wrapper input[type=file] { position: absolute; left: -9999px; }
        .search-box { margin-bottom: 20px; }
        .search-input { width: 100%; padding: 15px; background: #2a2a2a; border: 2px solid #333; border-radius: 10px; color: #fff; font-size: 16px; }
        .search-input:focus { outline: none; border-color: #d4af37; }
        .client-stats { font-size: 14px; color: #888; margin-top: 10px; }
        .status-badge { display: inline-block; padding: 5px 10px; border-radius: 5px; font-size: 12px; font-weight: bold; margin-top: 5px; }
        .status-pending { background: #ffc107; color: #000; }
        .status-confirmed { background: #007bff; color: #fff; }
        .status-completed { background: #28a745; color: #fff; }
        .status-cancelled { background: #dc3545; color: #fff; }
        .logo-preview-large { width: 100%; max-width: 300px; height: auto; border-radius: 10px; margin: 20px auto; display: block; border: 2px solid #d4af37; }
        .settings-section { margin-bottom: 30px; }
        .settings-title { font-size: 20px; color: #d4af37; margin-bottom: 15px; border-bottom: 1px solid #333; padding-bottom: 10px; }
    </style>
</head>
<body>
    <div class="header">
        <img src="https://i.ibb.co/dwMYqmPk/IMG-2261.jpg" class="header-logo" id="header-logo">
        <p>Painel Administrativo</p>
    </div>
    <div class="container" id="main-container"></div>
    <div id="modal" class="modal"></div>

    <script>
        const ADMIN_PASSWORD = 'matheus123';
        let isAdminLoggedIn = localStorage.getItem('adminLoggedIn') === 'true';
        let currentTab = 'bookings';

        const defaultServices = [
            {id:1, name:'Cabelo', price:40, duration:'30 min', icon:'‚úÇÔ∏è', image:''},
            {id:2, name:'Corte Completo', price:60, duration:'45 min', icon:'üíà', image:''},
            {id:3, name:'Barba', price:30, duration:'20 min', icon:'ü™í', image:''},
            {id:4, name:'Sobrancelha', price:10, duration:'10 min', icon:'üëÅÔ∏è', image:''},
            {id:5, name:'Luzes', price:80, duration:'60 min', icon:'‚ö°', image:''},
            {id:6, name:'Nevou', price:100, duration:'90 min', icon:'‚ùÑÔ∏è', image:''},
            {id:7, name:'Pigmenta√ß√£o', price:40, duration:'30 min', icon:'üé®', image:''}
        ];

        const defaultSettings = {
            logo: 'https://i.ibb.co/dwMYqmPk/IMG-2261.jpg',
            shopName: 'Matheus Barber Shop',
            location: 'Rio Verde - Goi√°s',
            schedule: 'Seg-S√°b 9h-20h',
            whatsapp: '5534991054546',
            instagram: 'matheusbarbershop123'
        };

        function getSettings() { return JSON.parse(localStorage.getItem('settings') || JSON.stringify(defaultSettings)); }
        function saveSettings(s) { localStorage.setItem('settings', JSON.stringify(s)); }
        function getServices() { return JSON.parse(localStorage.getItem('services') || JSON.stringify(defaultServices)); }
        function saveServices(s) { localStorage.setItem('services', JSON.stringify(s)); }
        function getBookings() { return JSON.parse(localStorage.getItem('bookings') || '[]'); }
        function updateBooking(id, u) { const b = getBookings(); const i = b.findIndex(x => x.id === id); if (i !== -1) { b[i] = {...b[i], ...u}; localStorage.setItem('bookings', JSON.stringify(b)); }}
        function deleteBooking(id) { localStorage.setItem('bookings', JSON.stringify(getBookings().filter(b => b.id !== id))); }

        function getAllClients() {
            const bookings = getBookings();
            const clientsMap = new Map();
            bookings.forEach(booking => {
                const phone = booking.customer.phone;
                if (!clientsMap.has(phone)) {
                    clientsMap.set(phone, { name: booking.customer.name, phone: booking.customer.phone, email: booking.customer.email || '', totalBookings: 0, totalSpent: 0, lastVisit: booking.date });
                }
                const client = clientsMap.get(phone);
                client.totalBookings++;
                if (booking.status === 'completed') client.totalSpent += booking.service.price;
                if (new Date(booking.date) > new Date(client.lastVisit)) client.lastVisit = booking.date;
            });
            return Array.from(clientsMap.values());
        }

        function loginAdmin() {
            if (document.getElementById('admin-password').value === ADMIN_PASSWORD) {
                isAdminLoggedIn = true;
                localStorage.setItem('adminLoggedIn', 'true');
                render();
            } else alert('Senha incorreta!');
        }

        function logoutAdmin() {
            isAdminLoggedIn = false;
            localStorage.removeItem('adminLoggedIn');
            render();
        }

        function renderAdminLogin() {
            const s = getSettings();
            document.getElementById('main-container').innerHTML = `
                <div class="admin-login">
                    <div class="welcome">
                        <img src="${s.logo}" class="logo-admin">
                        <h2>Acesso Admin</h2>
                        <p>Digite a senha</p>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Senha</label>
                        <input type="password" id="admin-password" class="form-input">
                    </div>
                    <button class="btn btn-primary" onclick="loginAdmin()">Entrar</button>
                    <button class="btn back-btn" onclick="location.href='index.html'">‚Üê Voltar</button>
                </div>`;
        }

        function showTab(tab) { currentTab = tab; renderAdminPanel(); }

        function renderAdminPanel() {
            const bookings = getBookings();
            const clients = getAllClients();
            const today = new Date().toDateString();
            const todayB = bookings.filter(b => new Date(b.date).toDateString() === today);
            const completed = bookings.filter(b => b.status === 'completed').length;
            const revenue = bookings.filter(b => b.status === 'completed').reduce((sum, b) => sum + b.service.price, 0);

            document.getElementById('main-container').innerHTML = `
                <div class="admin-header"><h2>Painel</h2><button class="logout-btn" onclick="logoutAdmin()">Sair</button></div>
                <div class="stats-grid">
                    <div class="stat-card"><div class="stat-number">${bookings.length}</div><div class="stat-label">Total</div></div>
                    <div class="stat-card"><div class="stat-number">${todayB.length}</div><div class="stat-label">Hoje</div></div>
                    <div class="stat-card"><div class="stat-number">${clients.length}</div><div class="stat-label">Clientes</div></div>
                    <div class="stat-card"><div class="stat-number">R$ ${revenue}</div><div class="stat-label">Faturamento</div></div>
                </div>
                <div class="tabs">
                    <button class="tab-btn ${currentTab === 'bookings' ? 'active' : ''}" onclick="showTab('bookings')">üìÖ Agenda</button>
                    <button class="tab-btn ${currentTab === 'clients' ? 'active' : ''}" onclick="showTab('clients')">üë• Clientes</button>
                    <button class="tab-btn ${currentTab === 'services' ? 'active' : ''}" onclick="showTab('services')">üíà Servi√ßos</button>
                    <button class="tab-btn ${currentTab === 'settings' ? 'active' : ''}" onclick="showTab('settings')">‚öôÔ∏è Config</button>
                </div>
                <div id="admin-content"></div>`;

            if (currentTab === 'bookings') renderBookingsList();
            else if (currentTab === 'clients') renderClientsList();
            else if (currentTab === 'services') renderServicesList();
            else renderSettings();
        }

        function renderSettings() {
            const s = getSettings();
            document.getElementById('admin-content').innerHTML = `
                <div class="settings-card">
                    <div class="settings-section">
                        <h3 class="settings-title">üé® Logo</h3>
                        <img src="${s.logo}" class="logo-preview-large" id="logo-preview-settings">
                        <div class="file-input-wrapper">
                            <label class="file-input-btn" for="logo-upload">üì∑ Trocar Logo</label>
                            <input type="file" id="logo-upload" accept="image/*" onchange="updateLogo(this)">
                        </div>
                    </div>
                    <div class="settings-section">
                        <h3 class="settings-title">üìù Informa√ß√µes</h3>
                        <div class="form-group"><label class="form-label">Nome</label><input type="text" id="shop-name" class="form-input" value="${s.shopName}"></div>
                        <div class="form-group"><label class="form-label">Localiza√ß√£o</label><input type="text" id="location" class="form-input" value="${s.location}"></div>
                        <div class="form-group"><label class="form-label">Hor√°rio</label><input type="text" id="schedule" class="form-input" value="${s.schedule}"></div>
                    </div>
                    <div class="settings-section">
                        <h3 class="settings-title">üì± Redes</h3>
                        <div class="form-group"><label class="form-label">WhatsApp</label><input type="text" id="whatsapp" class="form-input" value="${s.whatsapp}"></div>
                        <div class="form-group"><label class="form-label">Instagram (@)</label><input type="text" id="instagram" class="form-input" value="${s.instagram}"></div>
                    </div>
                    <button class="btn btn-primary" onclick="saveSettingsChanges()">üíæ Salvar</button>
                </div>`;
        }

        function updateLogo(input) {
            const preview = document.getElementById('logo-preview-settings');
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = e => { preview.src = e.target.result; };
                reader.readAsDataURL(input.files[0]);
            }
        }

        function saveSettingsChanges() {
            const s = {
                logo: document.getElementById('logo-preview-settings').src,
                shopName: document.getElementById('shop-name').value,
                location: document.getElementById('location').value,
                schedule: document.getElementById('schedule').value,
                whatsapp: document.getElementById('whatsapp').value,
                instagram: document.getElementById('instagram').value
            };
            saveSettings(s);
            document.getElementById('header-logo').src = s.logo;
            alert('‚úÖ Salvo!');
        }

        function renderBookingsList() {
            const bookings = getBookings().sort((a, b) => new Date(b.date) - new Date(a.date));
            document.getElementById('admin-content').innerHTML = bookings.length === 0 ? '<p style="text-align:center;color:#888;padding:40px">Nenhum agendamento</p>' : bookings.map(b => `
                <div class="booking-card">
                    <div class="booking-header"><div><div class="booking-client">${b.customer.name}</div><div class="booking-phone">üì± ${b.customer.phone}</div>${b.customer.email ? `<div class="client-email">üìß ${b.customer.email}</div>` : ''}<span class="status-badge status-${b.status}">${{pending:'Pendente',confirmed:'Confirmado',completed:'Conclu√≠do',cancelled:'Cancelado'}[b.status]}</span></div></div>
                    <div style="margin-bottom:10px"><div>üíà ${b.service.name} | üí∞ R$ ${b.service.price}</div><div style="color:#888;font-size:14px;margin-top:5px">üìÖ ${new Date(b.date).toLocaleDateString('pt-BR')} | üïê ${b.time}</div></div>
                    <div class="booking-actions">
                        <button class="action-btn btn-confirm" onclick="updateBooking('${b.id}', {status:'confirmed'}); render()">Confirmar</button>
                        <button class="action-btn btn-complete" onclick="updateBooking('${b.id}', {status:'completed'}); render()">Conclu√≠do</button>
                        <button class="action-btn btn-cancel" onclick="if(confirm('Cancelar?')) { deleteBooking('${b.id}'); render(); }">Cancelar</button>
                    </div>
                </div>`).join('');
        }

        function renderClientsList() {
            const clients = getAllClients().sort((a, b) => b.totalBookings - a.totalBookings);
            document.getElementById('admin-content').innerHTML = `
                <div class="search-box"><input type="text" id="client-search" class="search-input" placeholder="üîç Buscar..." oninput="filterClients()"></div>
                <div id="clients-list">${clients.length === 0 ? '<p style="text-align:center;color:#888;padding:40px">Nenhum cliente</p>' : clients.map(c => `
                    <div class="client-card" data-name="${c.name.toLowerCase()}" data-phone="${c.phone}">
                        <div class="client-header"><div><div class="client-name">üë§ ${c.name}</div><div class="client-phone">üì± ${c.phone}</div>${c.email ? `<div class="client-email">üìß ${c.email}</div>` : ''}<div class="client-stats">üìä ${c.totalBookings} agend. | üí∞ R$ ${c.totalSpent} | üìÖ ${new Date(c.lastVisit).toLocaleDateString('pt-BR')}</div></div></div>
                        <div class="booking-actions">
                            <button class="action-btn btn-confirm" onclick="window.open('https://wa.me/${c.phone.replace(/\D/g, '')}')">üí¨ WhatsApp</button>
                            ${c.email ? `<button class="action-btn btn-edit" onclick="location.href='mailto:${c.email}'">üìß Email</button>` : ''}
                        </div>
                    </div>`).join('')}</div>`;
        }

        function filterClients() {
            const search = document.getElementById('client-search').value.toLowerCase();
            document.querySelectorAll('.client-card').forEach(card => {
                card.style.display = (card.getAttribute('data-name').includes(search) || card.getAttribute('data-phone').includes(search)) ? 'block' : 'none';
            });
        }

        function renderServicesList() {
            const services = getServices();
            document.getElementById('admin-content').innerHTML = `
                <button class="btn btn-primary" onclick="openAddServiceModal()" style="margin-bottom:20px">‚ûï Adicionar</button>
                ${services.map(s => `<div class="service-card">${s.image ? `<img src="${s.image}" class="service-image">` : ''}<div class="service-header"><div class="service-info"><div class="service-icon">${s.icon}</div><div><div class="service-name">${s.name}</div><div class="service-duration">${s.duration}</div></div></div><div class="service-price">R$ ${s.price}</div></div><div class="booking-actions"><button class="action-btn btn-edit" onclick='openEditServiceModal(${JSON.stringify(s).replace(/'/g, "&apos;")})'>‚úèÔ∏è Editar</button><button class="action-btn btn-delete" onclick="deleteService(${s.id})">üóëÔ∏è Excluir</button></div></div>`).join('')}`;
        }

        function openAddServiceModal() {
            document.getElementById('modal').innerHTML = `<div class="modal-content"><span class="modal-close" onclick="closeModal()">&times;</span><h2 class="modal-title">‚ûï Adicionar</h2><div class="form-group"><label class="form-label">üì∏ Foto</label><div class="file-input-wrapper"><label class="file-input-btn" for="service-image-input">üì∑ Escolher</label><input type="file" id="service-image-input" accept="image/*" onchange="previewImage(this)"></div><img id="image-preview" class="image-preview"></div><div class="form-group"><label class="form-label">Nome</label><input type="text" id="service-name" class="form-input"></div><div class="form-group"><label class="form-label">Pre√ßo</label><input type="number" id="service-price" class="form-input"></div><div class="form-group"><label class="form-label">Dura√ß√£o</label><input type="text" id="service-duration" class="form-input" placeholder="30 min"></div><div class="form-group"><label class="form-label">√çcone</label><input type="text" id="service-icon" class="form-input" placeholder="üíà" maxlength="2"></div><button class="btn btn-primary" onclick="saveNewService()">Salvar</button><button class="btn back-btn" onclick="closeModal()">Cancelar</button></div>`;
            document.getElementById('modal').classList.add('active');
        }

        function openEditServiceModal(service) {
            document.getElementById('modal').innerHTML = `<div class="modal-content"><span class="modal-close" onclick="closeModal()">&times;</span><h2 class="modal-title">‚úèÔ∏è Editar</h2><div class="form-group"><label class="form-label">üì∏ Foto</label>${service.image ? `<img src="${service.image}" class="image-preview active" id="image-preview">` : '<img id="image-preview" class="image-preview">'}<div class="file-input-wrapper"><label class="file-input-btn" for="service-image-input">üì∑ ${service.image ? 'Trocar' : 'Adicionar'}</label><input type="file" id="service-image-input" accept="image/*" onchange="previewImage(this)"></div></div><div class="form-group"><label class="form-label">Nome</label><input type="text" id="service-name" class="form-input" value="${service.name}"></div><div class="form-group"><label class="form-label">Pre√ßo</label><input type="number" id="service-price" class="form-input" value="${service.price}"></div><div class="form-group"><label class="form-label">Dura√ß√£o</label><input type="text" id="service-duration" class="form-input" value="${service.duration}"></div><div class="form-group"><label class="form-label">√çcone</label><input type="text" id="service-icon" class="form-input" value="${service.icon}" maxlength="2"></div><button class="btn btn-primary" onclick="updateService(${service.id})">Salvar</button><button class="btn back-btn" onclick="closeModal()">Cancelar</button></div>`;
            document.getElementById('modal').classList.add('active');
        }

        function previewImage(input) {
            const preview = document.getElementById('image-preview');
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = e => { preview.src = e.target.result; preview.classList.add('active'); };
                reader.readAsDataURL(input.files[0]);
            }
        }

        function saveNewService() {
            const name = document.getElementById('service-name').value;
            const price = parseFloat(document.getElementById('service-price').value);
            const duration = document.getElementById('service-duration').value;
            const icon = document.getElementById('service-icon').value;
            const imagePreview = document.getElementById('image-preview');
            const image = imagePreview.classList.contains('active') ? imagePreview.src : '';
            if (!name || !price || !duration || !icon) { alert('Preencha todos!'); return; }
            const services = getServices();
            const newId = services.length > 0 ? Math.max(...services.map(s => s.id)) + 1 : 1;
            services.push({ id: newId, name, price, duration, icon, image });
            saveServices(services);
            closeModal();
            renderAdminPanel();
            alert('‚úÖ Adicionado!');
        }

        function updateService(id) {
            const name = document.getElementById('service-name').value;
            const price = parseFloat(document.getElementById('service-price').value);
            const duration = document.getElementById('service-duration').value;
            const icon = document.getElementById('service-icon').value;
            const imagePreview = document.getElementById('image-preview');
            const image = imagePreview.classList.contains('active') ? imagePreview.src : '';
            if (!name || !price || !duration || !icon) { alert('Preencha todos!'); return; }
            const services = getServices();
            const index = services.findIndex(s => s.id === id);
            if (index !== -1) { services[index] = { id, name, price, duration, icon, image }; saveServices(services); }
            closeModal();
            renderAdminPanel();
            alert('‚úÖ Atualizado!');
        }

        function deleteService(id) {
            if (!confirm('Excluir?')) return;
            saveServices(getServices().filter(s => s.id !== id));
            renderAdminPanel();
            alert('‚úÖ Exclu√≠do!');
        }

        function closeModal() { document.getElementById('modal').classList.remove('active'); }
        function render() { if (!isAdminLoggedIn) renderAdminLogin(); else renderAdminPanel(); }
        render();
    </script>
</body>
</html>
